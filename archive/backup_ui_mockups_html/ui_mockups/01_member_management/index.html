<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>会員管理 - ConnectEn SaaS</title>
  <link rel="stylesheet" href="../shared/css/common.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    /* Page-specific styles - Flat Modern Design */
    .page-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--spacing-2xl);
      padding-bottom: var(--spacing-lg);
      border-bottom: 1px solid var(--gray-200);
    }
    
    .page-title {
      font-size: var(--font-size-3xl);
      font-weight: 700;
      color: var(--gray-900);
      margin: 0;
      display: flex;
      align-items: center;
      gap: var(--spacing-md);
    }
    
    .page-title i {
      color: var(--gray-400);  /* アイコンは控えめに */
      font-size: var(--font-size-2xl);
    }
    
    .member-actions {
      display: flex;
      gap: var(--spacing-sm);  /* 間隔を詰める */
    }
    
    /* 統計カード - フラットデザイン適用 */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: var(--spacing-lg);
      margin-bottom: var(--spacing-2xl);
    }
    
    .stat-card {
      background: white;
      padding: var(--spacing-xl);
      border-radius: var(--radius-md);  /* より控えめなradius */
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--gray-200);
      text-align: center;
      transition: border-color 0.2s ease;
    }
    
    .stat-card:hover {
      border-color: var(--gray-300);  /* 軽いホバー効果 */
    }
    
    .stat-value {
      font-size: var(--font-size-3xl);
      font-weight: 700;
      color: var(--gray-900);  /* 数値はニュートラルカラーに変更 */
      margin-bottom: var(--spacing-sm);
      line-height: 1;
    }
    
    .stat-label {
      font-size: var(--font-size-sm);
      color: var(--gray-600);
      font-weight: 500;
      text-transform: none;  /* uppercase削除でシンプルに */
      letter-spacing: 0;
    }
    
    /* 特別な統計のみポイントカラー使用 */
    .stat-card.stat-primary .stat-value {
      color: var(--primary-color);
    }
    
    /* テーブル - フラットデザイン適用 */
    .member-table-wrapper {
      background: white;
      border-radius: var(--radius-md);  /* 控えめなradius */
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--gray-200);
      overflow: hidden;
    }
    
    .table-header {
      padding: var(--spacing-xl);
      border-bottom: 1px solid var(--gray-200);
      background: white;  /* グレー背景をwhiteに変更 */
    }
    
    .search-filters {
      display: grid;
      grid-template-columns: 2fr 1fr 1fr 1fr auto;
      gap: var(--spacing-md);
      align-items: end;
    }
    
    .result-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: var(--spacing-md) var(--spacing-xl);
      border-bottom: 1px solid var(--gray-200);
      background: var(--gray-50);
      font-size: var(--font-size-sm);
      color: var(--gray-600);
    }
    
    .pagination {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: var(--spacing-sm);
      padding: var(--spacing-lg);
      border-top: 1px solid var(--gray-200);
    }
    
    .pagination-btn {
      padding: var(--spacing-sm) var(--spacing-md);
      border: 1px solid var(--gray-300);
      background: white;
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .pagination-btn:hover {
      background: var(--gray-100);
    }
    
    .pagination-btn.active {
      background: var(--primary-color);
      color: white;
      border-color: var(--primary-color);
    }
    
    .pagination-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .member-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--gray-200);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      color: var(--gray-600);
    }
    
    .member-info {
      display: flex;
      align-items: center;
      gap: var(--spacing-md);
    }
    
    .member-name {
      font-weight: 600;
      color: var(--gray-900);
    }
    
    .member-id {
      font-size: var(--font-size-sm);
      color: var(--gray-500);
    }
    
    .action-buttons {
      display: flex;
      gap: var(--spacing-sm);
    }
    
    .btn-icon {
      width: 32px;
      height: 32px;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: var(--radius-sm);
    }
    
    .family-indicator {
      display: inline-flex;
      align-items: center;
      gap: var(--spacing-xs);
      padding: var(--spacing-xs) var(--spacing-sm);
      background: var(--info-color);
      color: white;
      border-radius: var(--radius-sm);
      font-size: var(--font-size-xs);
      font-weight: 500;
    }
    
    .quick-actions {
      position: fixed;
      bottom: 30px;
      right: 30px;
      z-index: 100;
    }
    
    /* FAB - フラットデザイン対応 */
    .fab {
      width: 56px;
      height: 56px;
      border-radius: var(--radius-xl);  /* 円形から角丸四角に変更 */
      background: var(--primary-color);
      color: white;
      border: none;
      box-shadow: var(--shadow-md);  /* 控えめなシャドウ */
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: var(--font-size-lg);
      transition: background-color 0.2s ease;  /* シンプルな遷移 */
    }
    
    .fab:hover {
      background: var(--primary-hover);
      /* transform・派手なシャドウ効果を削除 */
    }
    
    @media (max-width: 768px) {
      .search-filters {
        grid-template-columns: 1fr;
        gap: var(--spacing-sm);
      }
      
      .page-header {
        flex-direction: column;
        gap: var(--spacing-md);
        align-items: stretch;
      }
      
      .member-actions {
        justify-content: center;
      }
      
      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="container">
      <div class="header-content">
        <a href="#" class="logo">
          <i class="fas fa-dance"></i> ConnectEn
        </a>
        <div class="header-actions">
          <span class="text-sm text-gray-600">エン株式会社様</span>
          <div class="flex items-center gap-4">
            <button class="btn-icon btn-secondary" data-tooltip="通知">
              <i class="fas fa-bell"></i>
            </button>
            <button class="btn-icon btn-secondary" data-tooltip="設定">
              <i class="fas fa-cog"></i>
            </button>
            <button class="btn-icon btn-secondary" data-tooltip="ユーザーメニュー">
              <i class="fas fa-user"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  </header>

  <div class="main-content">
    <!-- Sidebar -->
    <nav class="sidebar">
      <ul class="nav-menu">
        <li class="nav-item">
          <a href="#" class="nav-link">
            <i class="nav-icon fas fa-chart-line"></i>
            ダッシュボード
          </a>
        </li>
        <li class="nav-item">
          <a href="#" class="nav-link active">
            <i class="nav-icon fas fa-users"></i>
            会員管理
          </a>
        </li>
        <li class="nav-item">
          <a href="#" class="nav-link">
            <i class="nav-icon fas fa-calendar-alt"></i>
            レッスン予約
          </a>
        </li>
        <li class="nav-item">
          <a href="#" class="nav-link">
            <i class="nav-icon fas fa-credit-card"></i>
            決済管理
          </a>
        </li>
        <li class="nav-item">
          <a href="#" class="nav-link">
            <i class="nav-icon fas fa-user-tie"></i>
            スタッフ管理
          </a>
        </li>
        <li class="nav-item">
          <a href="#" class="nav-link">
            <i class="nav-icon fas fa-building"></i>
            施設管理
          </a>
        </li>
        <li class="nav-item">
          <a href="#" class="nav-link">
            <i class="nav-icon fas fa-chart-bar"></i>
            レポート
          </a>
        </li>
        <li class="nav-item">
          <a href="#" class="nav-link">
            <i class="nav-icon fas fa-cog"></i>
            設定
          </a>
        </li>
      </ul>
    </nav>

    <!-- Main Content Area -->
    <main class="content-area">
      <div class="page-header">
        <h1 class="page-title">
          <i class="fas fa-users"></i> 会員管理
        </h1>
        <div class="member-actions">
          <button class="btn btn-secondary">
            <i class="fas fa-file-export"></i> エクスポート
          </button>
          <button class="btn btn-secondary">
            <i class="fas fa-file-import"></i> インポート
          </button>
          <button class="btn btn-primary" data-modal-target="newMemberModal">
            <i class="fas fa-plus"></i> 新規会員登録
          </button>
        </div>
      </div>

      <!-- Statistics Cards - ポイントカラー戦略適用 -->
      <div class="stats-grid">
        <div class="stat-card stat-primary">
          <div class="stat-value">1,247</div>
          <div class="stat-label">総会員数</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">1,198</div>
          <div class="stat-label">アクティブ会員</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">32</div>
          <div class="stat-label">休会中</div>
        </div>
        <div class="stat-card stat-primary">
          <div class="stat-value">+17</div>
          <div class="stat-label">今月新規</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">156</div>
          <div class="stat-label">ファミリー会員</div>
        </div>
      </div>

      <!-- Member Table -->
      <div class="member-table-wrapper">
        <div class="table-header">
          <div class="search-filters">
            <div class="form-group mb-0">
              <label class="form-label">検索</label>
              <input type="text" class="form-input search-input" placeholder="会員名、メールアドレス、電話番号で検索">
            </div>
            <div class="form-group mb-0">
              <label class="form-label">ステータス</label>
              <select class="form-select filter-select" data-filter="status">
                <option value="">すべて</option>
                <option value="active">アクティブ</option>
                <option value="suspended">休会中</option>
                <option value="inactive">退会済み</option>
              </select>
            </div>
            <div class="form-group mb-0">
              <label class="form-label">会員種別</label>
              <select class="form-select filter-select" data-filter="type">
                <option value="">すべて</option>
                <option value="regular">本会員</option>
                <option value="virtual">バーチャル会員</option>
                <option value="trial">体験会員</option>
              </select>
            </div>
            <div class="form-group mb-0">
              <label class="form-label">スタジオ</label>
              <select class="form-select filter-select" data-filter="studio">
                <option value="">すべて</option>
                <option value="shibuya">渋谷校</option>
                <option value="yokohama">横浜校</option>
                <option value="gunma">群馬校</option>
                <option value="tochigi">栃木校</option>
              </select>
            </div>
            <button class="btn btn-primary">
              <i class="fas fa-search"></i> 検索
            </button>
          </div>
        </div>

        <div class="result-info">
          <span class="result-count">1,247 件表示</span>
          <div class="view-options">
            <button class="btn-icon btn-secondary" data-tooltip="詳細表示">
              <i class="fas fa-list"></i>
            </button>
            <button class="btn-icon btn-secondary" data-tooltip="カード表示">
              <i class="fas fa-th"></i>
            </button>
          </div>
        </div>

        <div class="table-container">
          <table class="table data-table">
            <thead>
              <tr>
                <th>
                  <input type="checkbox" id="selectAll">
                </th>
                <th data-sortable="name">会員情報</th>
                <th data-sortable="type">種別</th>
                <th data-sortable="status">ステータス</th>
                <th data-sortable="studio">メインスタジオ</th>
                <th data-sortable="lastVisit">最終利用日</th>
                <th data-sortable="joinDate">入会日</th>
                <th data-sortable="monthlyFee">月謝</th>
                <th>操作</th>
              </tr>
            </thead>
            <tbody id="memberTableBody">
              <!-- Sample data rows -->
              <tr>
                <td><input type="checkbox" class="member-checkbox"></td>
                <td>
                  <div class="member-info">
                    <div class="member-avatar">田中</div>
                    <div>
                      <div class="member-name">田中 太郎</div>
                      <div class="member-id">ID: M001234</div>
                      <div class="family-indicator">
                        <i class="fas fa-users"></i> ファミリー (3名)
                      </div>
                    </div>
                  </div>
                </td>
                <td data-column="type">
                  <span class="badge badge-success">本会員</span>
                </td>
                <td data-column="status">
                  <span class="badge badge-success">アクティブ</span>
                </td>
                <td data-column="studio">渋谷校</td>
                <td data-column="lastVisit">2024-11-25</td>
                <td data-column="joinDate">2023-04-15</td>
                <td data-column="monthlyFee">¥12,000</td>
                <td>
                  <div class="action-buttons">
                    <button class="btn-icon btn-secondary" data-tooltip="詳細表示">
                      <i class="fas fa-eye"></i>
                    </button>
                    <button class="btn-icon btn-secondary" data-tooltip="編集">
                      <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn-icon btn-secondary" data-tooltip="履歴">
                      <i class="fas fa-history"></i>
                    </button>
                    <button class="btn-icon btn-secondary" data-tooltip="その他">
                      <i class="fas fa-ellipsis-v"></i>
                    </button>
                  </div>
                </td>
              </tr>
              <tr>
                <td><input type="checkbox" class="member-checkbox"></td>
                <td>
                  <div class="member-info">
                    <div class="member-avatar">佐藤</div>
                    <div>
                      <div class="member-name">佐藤 花子</div>
                      <div class="member-id">ID: M001235</div>
                    </div>
                  </div>
                </td>
                <td data-column="type">
                  <span class="badge badge-info">バーチャル会員</span>
                </td>
                <td data-column="status">
                  <span class="badge badge-success">アクティブ</span>
                </td>
                <td data-column="studio">横浜校</td>
                <td data-column="lastVisit">2024-11-24</td>
                <td data-column="joinDate">2024-03-10</td>
                <td data-column="monthlyFee">¥8,000</td>
                <td>
                  <div class="action-buttons">
                    <button class="btn-icon btn-secondary" data-tooltip="詳細表示">
                      <i class="fas fa-eye"></i>
                    </button>
                    <button class="btn-icon btn-secondary" data-tooltip="編集">
                      <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn-icon btn-secondary" data-tooltip="履歴">
                      <i class="fas fa-history"></i>
                    </button>
                    <button class="btn-icon btn-secondary" data-tooltip="その他">
                      <i class="fas fa-ellipsis-v"></i>
                    </button>
                  </div>
                </td>
              </tr>
              <tr>
                <td><input type="checkbox" class="member-checkbox"></td>
                <td>
                  <div class="member-info">
                    <div class="member-avatar">鈴木</div>
                    <div>
                      <div class="member-name">鈴木 一郎</div>
                      <div class="member-id">ID: M001236</div>
                    </div>
                  </div>
                </td>
                <td data-column="type">
                  <span class="badge badge-warning">体験会員</span>
                </td>
                <td data-column="status">
                  <span class="badge badge-warning">休会中</span>
                </td>
                <td data-column="studio">群馬校</td>
                <td data-column="lastVisit">2024-10-15</td>
                <td data-column="joinDate">2024-10-01</td>
                <td data-column="monthlyFee">¥0</td>
                <td>
                  <div class="action-buttons">
                    <button class="btn-icon btn-secondary" data-tooltip="詳細表示">
                      <i class="fas fa-eye"></i>
                    </button>
                    <button class="btn-icon btn-secondary" data-tooltip="編集">
                      <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn-icon btn-secondary" data-tooltip="履歴">
                      <i class="fas fa-history"></i>
                    </button>
                    <button class="btn-icon btn-secondary" data-tooltip="その他">
                      <i class="fas fa-ellipsis-v"></i>
                    </button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Pagination -->
        <div class="pagination">
          <button class="pagination-btn" disabled>
            <i class="fas fa-chevron-left"></i>
          </button>
          <button class="pagination-btn active">1</button>
          <button class="pagination-btn">2</button>
          <button class="pagination-btn">3</button>
          <button class="pagination-btn">...</button>
          <button class="pagination-btn">42</button>
          <button class="pagination-btn">
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </div>

      <!-- Quick Actions Button -->
      <div class="quick-actions">
        <button class="fab" data-modal-target="newMemberModal" data-tooltip="新規会員登録">
          <i class="fas fa-plus"></i>
        </button>
      </div>
    </main>
  </div>

  <!-- New Member Modal -->
  <div class="modal-overlay" id="newMemberModal">
    <div class="modal" style="width: 800px;">
      <div class="modal-header">
        <h3 class="modal-title">新規会員登録</h3>
        <button class="modal-close" data-modal-close>
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <form id="newMemberForm">
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--spacing-lg);">
            <div class="form-group">
              <label class="form-label">姓 *</label>
              <input type="text" class="form-input" required>
            </div>
            <div class="form-group">
              <label class="form-label">名 *</label>
              <input type="text" class="form-input" required>
            </div>
            <div class="form-group">
              <label class="form-label">姓（カナ） *</label>
              <input type="text" class="form-input" required>
            </div>
            <div class="form-group">
              <label class="form-label">名（カナ） *</label>
              <input type="text" class="form-input" required>
            </div>
            <div class="form-group">
              <label class="form-label">メールアドレス *</label>
              <input type="email" class="form-input" required>
            </div>
            <div class="form-group">
              <label class="form-label">電話番号 *</label>
              <input type="tel" class="form-input" required>
            </div>
            <div class="form-group">
              <label class="form-label">生年月日</label>
              <input type="date" class="form-input">
            </div>
            <div class="form-group">
              <label class="form-label">性別</label>
              <select class="form-select">
                <option value="">選択してください</option>
                <option value="male">男性</option>
                <option value="female">女性</option>
                <option value="other">その他</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">会員種別 *</label>
              <select class="form-select" required>
                <option value="">選択してください</option>
                <option value="regular">本会員</option>
                <option value="virtual">バーチャル会員</option>
                <option value="trial">体験会員</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">メインスタジオ *</label>
              <select class="form-select" required>
                <option value="">選択してください</option>
                <option value="shibuya">渋谷校</option>
                <option value="yokohama">横浜校</option>
                <option value="gunma">群馬校</option>
                <option value="tochigi">栃木校</option>
              </select>
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">住所</label>
            <textarea class="form-textarea" rows="3"></textarea>
          </div>
          <div class="form-group">
            <label class="form-label">備考</label>
            <textarea class="form-textarea" rows="3"></textarea>
          </div>
          <div class="form-group">
            <label class="checkbox-wrapper" style="display: flex; align-items: center; gap: var(--spacing-sm); cursor: pointer;">
              <input type="checkbox" required>
              <span>利用規約に同意する *</span>
            </label>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-modal-close>キャンセル</button>
        <button class="btn btn-primary" onclick="submitNewMember()">登録</button>
      </div>
    </div>
  </div>

  <script src="../shared/js/common.js"></script>
  <script>
    // Page-specific JavaScript
    function submitNewMember() {
      const form = document.getElementById('newMemberForm');
      if (app.validateForm(form)) {
        app.showLoading(event.target);
        
        // Simulate API call
        setTimeout(() => {
          app.hideLoading(event.target);
          app.closeModal(document.getElementById('newMemberModal'));
          app.showToast('新規会員を登録しました', 'success');
          
          // Reset form
          form.reset();
          
          // Refresh table data
          refreshMemberTable();
        }, 1000);
      }
    }

    function refreshMemberTable() {
      // In a real application, this would fetch data from the server
      app.showToast('会員データを更新しました', 'info');
    }

    // Initialize page
    document.addEventListener('DOMContentLoaded', function() {
      // Setup select all checkbox
      const selectAllCheckbox = document.getElementById('selectAll');
      const memberCheckboxes = document.querySelectorAll('.member-checkbox');

      selectAllCheckbox.addEventListener('change', function() {
        memberCheckboxes.forEach(checkbox => {
          checkbox.checked = this.checked;
        });
      });

      // Update select all when individual checkboxes change
      memberCheckboxes.forEach(checkbox => {
        checkbox.addEventListener('change', function() {
          const checkedCount = document.querySelectorAll('.member-checkbox:checked').length;
          selectAllCheckbox.checked = checkedCount === memberCheckboxes.length;
          selectAllCheckbox.indeterminate = checkedCount > 0 && checkedCount < memberCheckboxes.length;
        });
      });

      // Initialize search functionality
      app.initializeSearchFilters();

      // Handle new member form submission
      document.getElementById('newMemberForm').addEventListener('submit', function(e) {
        e.preventDefault();
        if (app.validateForm(this)) {
          app.showToast('新規会員が登録されました', 'success');
          app.closeModal(document.getElementById('newMemberModal'));
          this.reset();
          // In real implementation, would refresh member list
        }
      });
      
      // Show welcome message
      setTimeout(() => {
        app.showToast('会員管理画面へようこそ', 'info');
      }, 500);
    });
  </script>
</body>
</html>
# ConnectEn SaaS化 最新システム修正計画
## 作成日: 2025年8月5日

---

## 1. 最新議事録からの重要な追加要件（2025年7月31日）

### 1.1 新たに判明した重要機能
1. **ファミリーアカウント機能**（MindBody参考）
   - 親御さんのアカウントに子供のアカウントを紐付け
   - アカウント間でのスイッチング機能
   - 家族全員の会員番号への個別ログイン/ログアウト不要
   - 「なりすまし機能」による親→子のアカウント操作

2. **体験レッスンからのプロモーション強化**
   - 体験レッスン応募→バーチャル会員化の自動化
   - アンケート機能の統合（現在はGoogleフォーム外部運用）
   - 体験レッスン受講者への自動プロモーション
   - 本会員への移行導線の最適化

3. **イベント参加者へのマーケティング機能**
   - イベント参加者情報の活用
   - イベント後の自動メール配信
   - チラシ配布記録との連携

### 1.2 インフラ・運用面の課題
1. **防犯カメラシステム連携**
   - 現在のカメラシステムの不具合対応
   - 容量問題の解決
   - 物理的なフォーカス調整の改善

2. **インターネット回線の改善**
   - 現在はゲストアクセス不可、キャパオーバー状態
   - スタジオ運営に必要なネットワーク環境の整備

---

## 2. SaaS化に伴う全体システム構成

### 2.1 プラットフォーム階層構造

```
┌─────────────────────────────────────────────────┐
│           Platform Layer (プラットフォーム層)              │
├─────────────────────────────────────────────────┤
│ Super Admin                                   │
│ ├── テナント管理 (会社一覧、契約管理)                     │
│ ├── 課金・請求システム                                │
│ ├── プラットフォーム分析                               │
│ └── AI補助機能管理 (補助金対象)                        │
├─────────────────────────────────────────────────┤
│           Tenant Layer (テナント層)                    │
├─────────────────────────────────────────────────┤
│ Tenant A: En Dance Studio                    │
│ Tenant B: 他ダンススタジオ                           │  
│ Tenant N: ...                               │
├─────────────────────────────────────────────────┤
│        Shared Services (共通サービス層)               │
├─────────────────────────────────────────────────┤
│ ├── 認証・認可 (OAuth2.0 + Tenant Context)         │
│ ├── API Gateway (/api/v1/{tenantId}/)           │
│ ├── 通知サービス (Email/SMS/LINE/Push)              │
│ ├── AI・ML サービス (補助金対象)                       │
│ └── 決済統合サービス                                │
└─────────────────────────────────────────────────┘
```

### 2.2 新システム全体機能一覧

## A. プラットフォーム管理機能（Super Admin用）

### A-1. テナント管理
- **テナント登録・編集**
  - 新規ダンススタジオの登録
  - 基本情報管理（スタジオ名、住所、連絡先等）
  - 契約プラン設定（Basic/Professional/Enterprise）
  - 機能フラグ制御（テナント別有効/無効機能）

- **テナント状態管理**
  - アクティブ/非アクティブ/試用期間/解約済み
  - 自動停止/再開処理
  - データアーカイブ/削除

### A-2. 課金・契約管理
- **サブスクリプション管理**
  - 月額/年額プランの設定・変更
  - 利用量ベース課金（アクティブ会員数、API呼び出し数）
  - 自動請求処理・督促

- **利用量モニタリング**
  - テナント別のリソース使用量追跡
  - アラート・上限制御
  - コスト最適化提案

### A-3. プラットフォーム分析
- **業界ベンチマーク**
  - 匿名化されたテナント間比較
  - 業界平均との比較分析
  - 成長トレンド可視化

- **プラットフォーム運用分析**
  - 全体KPI（総会員数、総売上、稼働率）
  - テナント健全性スコア
  - 解約予測・リテンション分析

### A-4. AI補助機能管理（補助金対象）
- **AI機能の統一管理**
  - 需要予測モデルの統一運用
  - レコメンデーションエンジン
  - 異常検知・予防保全
  - 自動最適化機能

---

## B. テナント機能（各ダンススタジオ用）

### B-1. 会員管理機能（強化版）

#### 基本会員管理
- **ファミリーアカウント機能**（新規・最重要）
  - 親子アカウントの紐付け・管理
  - アカウントスイッチング機能
  - 家族間でのスケジュール共有
  - 親による子アカウントの代理操作
  - 渋谷校約50名の家族会員への対応

- **会員種別管理**
  - 本会員/バーチャル会員/体験会員
  - 会員ランク制度（利用頻度・金額ベース）
  - 自動ランクアップ/ダウン処理

#### 高度な会員機能
- **同一人物判定機能**（重要追加）
  - メールアドレス変更時の重複登録防止
  - 名前・電話番号・住所での照合
  - 既存会員との名寄せ処理

- **ブラックリスト機能強化**
  - 強制退会者の記録・管理
  - 理由記録用メモ欄
  - 新規登録時の自動チェック

### B-2. 体験レッスン・プロモーション機能（大幅強化）

#### 体験レッスン管理
- **体験レッスン応募システム**
  - Web応募フォームとマイページ連携
  - 自動バーチャル会員化
  - 週1〜2回の定期開催管理（渋谷校・スクランブル校中心）

- **体験後プロモーション**
  - 自動アンケート配信（Googleフォーム→システム内統合）
  - 体験者への段階的プロモーション
  - 本会員移行の導線最適化
  - スタッフによる電話フォローアップ支援

#### マーケティング連携
- **SNS・インスタ連携強化**
  - 体験レッスン募集の投稿自動化
  - ハッシュタグ管理・効果測定
  - インフルエンサー連携管理

### B-3. イベント・発表会管理（強化版）

#### イベント参加者管理
- **参加者情報活用**
  - イベント参加履歴の記録
  - 参加者属性分析
  - 次回イベント案内の自動配信

- **年最大イベント対応**（お盆イベント等）
  - 8月11日〜17日のような大型イベント管理
  - 休校期間との連携管理
  - イベント後のフォローアップ自動化

#### マーケティング機能
- **イベント参加者へのプロモーション**
  - イベント後の自動メール配信
  - チラシ配布記録との連携
  - 入会促進キャンペーンの自動適用

### B-4. 紹介プログラム（自動化）

#### 友達紹介プログラム
- **インセンティブ自動化**
  - 紹介者・被紹介者へのポイント自動付与
  - 紹介達成時の特典配布
  - 紹介実績の可視化

#### 講師紹介プログラム  
- **講師経由入会の管理**
  - 講師へのキャッシュバック自動計算
  - 生徒へのポイント付与
  - 講師別の紹介実績管理

### B-5. 決済・課金システム（エリア別対応）

#### マルチエリア対応
- **渋谷・横浜エリア**
  - JACS（クレジットカード・口座振替）
  - GMO決済連携
  - 3ヶ月後の債権回収→強制退会自動化

- **群馬・栃木エリア**
  - 群馬銀行連携
  - JACS不使用
  - 手動債権回収フロー

#### 決済状態管理
- **自動フェイルオーバー**
  - クレカ失敗→口座振替→店頭支払いの自動遷移
  - 決済状況の自動通知
  - エラー時の明確なステータス表示

### B-6. QRコード・受付システム

#### セキュリティ強化
- **動的QRコード生成**
  - マイページでの毎回可変ユニークQR表示
  - 使い回し不正防止
  - 受付時の必須読み取り処理

#### 同時アクセス対応
- **高負荷時の処理**
  - イベント・発表会前後の集中アクセス対策
  - 最大1000人/1時間の想定
  - 待機・順番処理システム

---

## C. AI・自動化機能（補助金対象）

### C-1. 需要予測・最適化
- **レッスン需要予測**
  - 過去データに基づく参加者数予測
  - 季節要因・イベント影響の学習
  - スタジオ・時間帯別の最適化提案

### C-2. 顧客体験向上
- **パーソナライゼーション**
  - 個人の嗜好に基づくレッスン推奨
  - 最適な時間帯・講師の提案
  - 退会リスクの早期発見・対策提案

### C-3. 運営効率化
- **スタッフ業務支援**
  - 未ログイン者への自動案内
  - 問い合わせの自動分類・回答提案
  - フォローアップタスクの自動生成

---

## 3. 実装計画（設計段階のため詳細は今後決定）

*実装の優先度とスケジュールについては、詳細設計完了後に改めて策定予定*

---

## 4. 技術的な修正内容

### 4.1 データベース設計
- 全テーブルへのtenant_id追加
- Row Level Security (RLS)実装
- ファミリーアカウント用のリレーション設計
- 体験レッスン→本会員移行の履歴管理

### 4.2 認証システム
- JWTトークンへのテナント情報追加
- ファミリーアカウント切り替え機能
- 階層的権限管理（Platform/Tenant/Family level）

### 4.3 API設計
- `/api/v1/{tenantCode}/` 形式への変更
- テナントコンテキストの自動注入
- ファミリーアカウント操作用API

### 4.4 フロントエンド
- テナント別テーマ・ブランディング
- ファミリーアカウント切り替えUI
- 体験レッスン専用フロー

---

## 5. 次のアクション

### 即座に必要な対応
1. **本計画書の承認確認**（8月5日まで）
2. **ファミリーアカウント機能の詳細設計**（最優先）
3. **体験レッスンフローの詳細設計**
4. **マルチテナント基盤の技術設計開始**

### 追加で確認が必要な事項
1. ファミリーアカウントの具体的な運用ルール
2. 体験レッスンからのコンバージョン目標値
3. 各エリア（渋谷/横浜 vs 群馬/栃木）の運用差異の詳細
4. 防犯カメラ・ネットワーク環境の改善計画との連携

---

このSaaS化により、En Dance Studioの運営効率化だけでなく、業界全体のDX推進に貢献し、補助金要件を満たす「スタジオ運営者向けサービス」として発展させていきます。